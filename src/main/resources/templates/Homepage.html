<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>All Users</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h1 class="text-center">Real-Time Chat Application</h1>
    <div id="chat" class="border rounded p-3 mb-3" style="height: 300px; overflow-y: auto;">
        <h1 class="text-center">Available Users</h1>
        <div id="userList" class="list-group mt-4"></div>
    </div>

</div>
</body>

<script>
    window.onload = function () {
        // âœ… Retrieve from localStorage
        const currentUser = JSON.parse(localStorage.getItem("currentUser"));
        const currentUserId = currentUser?.userId;
        const currentUsername = currentUser?.username;

        fetch("http://localhost:8080/chat-app/users")
            .then(response => response.json())
            .then(users => {
                const userList = document.getElementById("userList");
                users.forEach(user => {
                    if (user.username !== currentUsername) { // Don't show current user
                        const userItem = document.createElement("button");
                        userItem.className = "list-group-item list-group-item-action";
                        userItem.textContent = user.username;
                        userItem.onclick = () => {
                            window.location.href = `PrivateChat.html?userId=${user.userId}`;
                        };
                        userList.appendChild(userItem);
                    }
                });
            });
    };
</script>

</html>
